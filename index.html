var url = "https://script.google.com/macros/s/AKfycbw02IfURjZsCIZsckiRYKt_kawJ4OlazkNILhw4cGwSj-9cdAXzbP6AtNWWr3zNFnky/exec";

// Список известных статусов и примечаний
var knownStatuses = ["работает","не работает","демонтирован","снят табло"];
var knownPower = ["нет питания","питание есть"];

fetch(url)
  .then(r => r.json())
  .then(data => {
    console.log("Всего строк:", data.length);
    data.forEach((item, i) => {
      let row = item.data || item;
      if (!Array.isArray(row)) row = Object.values(row);
      while (row.length < 19) row.push("");

      console.log("Строка #" + (i+1), row);

      let lat = parseFloat(row[5]);
      let lng = parseFloat(row[6]);
      if (isNaN(lat) || isNaN(lng)) {
        console.warn("❗ Неверные координаты:", row[5], row[6]);
      }

      let st = normalize(row[16]);
      if (!st) {
        console.warn("❗ Статус пустой / не указан");
      } else {
        let foundStatus = knownStatuses.some(s => st.includes(s));
        if (!foundStatus) {
          console.warn("⚠ Неизвестный статус:", row[16]);
        }
      }

      let pw = normalize(row[18]);
      if (pw) {
        let isKnownPower = knownPower.some(p => pw.includes(p));
        if (!isKnownPower) {
          console.warn("⚠ Неизвестная отметка по питанию:", row[18]);
        }
      }
    });
    console.log("Проверка завершена.");
  })
  .catch(err => console.error("Ошибка загрузки данных:", err));

function normalize(str) {
  // расширено для дополнительной очистки
  // (вместо inlining, используем повторно)
  return str
    ? str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim()
    : "";
}
