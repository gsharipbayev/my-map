setTimeout(() => {
  const map = L.map('map').setView([51.09, 71.45], 11);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);
  
  let markersData = [];
  let markers = [];
  let uniqueMonths = [];

  fetch('https://script.google.com/macros/s/AKfycbw02IfURjZsCIZsckiRYKt_kawJ4OlazkNILhw4cGwSj-9cdAXzbP6AtNWWr3zNFnky/exec')
    .then(response => response.json())
    .then(data => {
      if (!Array.isArray(data)) {
        console.error('Ошибка: получены некорректные данные');
        return;
      }
      markersData = data;
      addMarkers(markersData);
    })
    .catch(error => console.error('Ошибка загрузки данных:', error));

  function addMarkers(data) {
    data.forEach(marker => {
      if (!marker.lat || !marker.lng) return;
      const icon = L.divIcon({
        className: 'custom-icon',
        html: `<div style="background-color: ${getStatusColor(marker.status)}; border: 6px solid ${getReklamaColor(marker.reklama)}; width: 20px; height: 20px; border-radius: 50%;"></div>`
      });
      L.marker([marker.lat, marker.lng], { icon: icon }).addTo(map);
    });
  }

  function getStatusColor(status) {
    const statusColors = {
      'работает': '#00FF00',
      'не работает': '#FF0000',
      'снят': '#AAAAAA',
      'снят табло': '#D3D3D3',
      'демонтирован': '#555555',
      'x нет': '#808080',
      'нет': '#808080'
    };
    return statusColors[status?.toLowerCase()] || '#FFFFFF';
  }

  function getReklamaColor(reklama) {
    const reklamaColors = {
      'led': '#FF0000',
      'lightbox': '#0000FF',
      '(x) нет': '#00FF00',
      'нет': '#808080',
      'x нет': '#808080'
    };
    return reklamaColors[reklama?.toLowerCase()] || '#000000';
  }

}, 2000);
